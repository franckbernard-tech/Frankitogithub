{
  "name": "ðŸ”§ RÃ©parer SSH + DÃ©ployer (Nodes Natifs)",
  "nodes": [
    {
      "parameters": {},
      "name": "START",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "command": "sed -i 's/Port 2222/Port 22/g' /etc/ssh/sshd_config && sed -i 's/#Port 22/Port 22/g' /etc/ssh/sshd_config && systemctl restart sshd && echo 'SSH rÃ©parÃ© sur port 22'"
      },
      "name": "1ï¸âƒ£ RÃ©parer SSH",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "command": "ss -tlnp | grep :22 || netstat -tlnp | grep :22"
      },
      "name": "VÃ©rifier SSH port 22",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "command": "mkdir -p /root/frankito-bot"
      },
      "name": "2ï¸âƒ£ CrÃ©er rÃ©pertoire",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "command": "cat > /root/frankito-bot/bot.js << 'EOFBOT'\nconst { Telegraf } = require('telegraf');\n\nconst BOT_TOKEN = '8510817329:AAE72JsuTE_r-sAnclrNN5APE1wIDeKKGXE';\nconst bot = new Telegraf(BOT_TOKEN);\n\nbot.start((ctx) => {\n  ctx.reply('ðŸ‘‹ Bienvenue sur Frankito Bot!\\n\\nCommandes:\\n/start - Afficher ce message\\n/ping - Tester le bot');\n});\n\nbot.command('ping', (ctx) => {\n  ctx.reply('ðŸ“ Pong !');\n});\n\nbot.catch((err) => console.error('âŒ Erreur:', err));\nbot.launch();\nconsole.log('âœ… Frankito Bot dÃ©marrÃ©!');\nprocess.once('SIGINT', () => bot.stop('SIGINT'));\nprocess.once('SIGTERM', () => bot.stop('SIGTERM'));\nEOFBOT\necho 'bot.js crÃ©Ã©'"
      },
      "name": "CrÃ©er bot.js",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "command": "cat > /root/frankito-bot/package.json << 'EOFPKG'\n{\n  \"name\": \"frankito-bot\",\n  \"version\": \"1.0.0\",\n  \"main\": \"bot.js\",\n  \"dependencies\": {\n    \"telegraf\": \"^4.12.2\"\n  }\n}\nEOFPKG\necho 'package.json crÃ©Ã©'"
      },
      "name": "CrÃ©er package.json",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "command": "cd /root/frankito-bot && npm install --production"
      },
      "name": "3ï¸âƒ£ Installer telegraf",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "command": "pm2 delete frankito-bot || echo 'Pas de processus existant'"
      },
      "name": "Nettoyer PM2",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1650, 300]
    },
    {
      "parameters": {
        "command": "cd /root/frankito-bot && pm2 start bot.js --name frankito-bot"
      },
      "name": "4ï¸âƒ£ Lancer avec PM2",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1850, 300]
    },
    {
      "parameters": {
        "command": "pm2 save"
      },
      "name": "Sauvegarder PM2",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [2050, 300]
    },
    {
      "parameters": {
        "command": "pm2 list && echo '---' && pm2 logs frankito-bot --lines 5 --nostream"
      },
      "name": "5ï¸âƒ£ Statut Final",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [2250, 300]
    }
  ],
  "connections": {
    "START": {
      "main": [[{ "node": "1ï¸âƒ£ RÃ©parer SSH", "type": "main", "index": 0 }]]
    },
    "1ï¸âƒ£ RÃ©parer SSH": {
      "main": [[{ "node": "VÃ©rifier SSH port 22", "type": "main", "index": 0 }]]
    },
    "VÃ©rifier SSH port 22": {
      "main": [[{ "node": "2ï¸âƒ£ CrÃ©er rÃ©pertoire", "type": "main", "index": 0 }]]
    },
    "2ï¸âƒ£ CrÃ©er rÃ©pertoire": {
      "main": [[{ "node": "CrÃ©er bot.js", "type": "main", "index": 0 }]]
    },
    "CrÃ©er bot.js": {
      "main": [[{ "node": "CrÃ©er package.json", "type": "main", "index": 0 }]]
    },
    "CrÃ©er package.json": {
      "main": [[{ "node": "3ï¸âƒ£ Installer telegraf", "type": "main", "index": 0 }]]
    },
    "3ï¸âƒ£ Installer telegraf": {
      "main": [[{ "node": "Nettoyer PM2", "type": "main", "index": 0 }]]
    },
    "Nettoyer PM2": {
      "main": [[{ "node": "4ï¸âƒ£ Lancer avec PM2", "type": "main", "index": 0 }]]
    },
    "4ï¸âƒ£ Lancer avec PM2": {
      "main": [[{ "node": "Sauvegarder PM2", "type": "main", "index": 0 }]]
    },
    "Sauvegarder PM2": {
      "main": [[{ "node": "5ï¸âƒ£ Statut Final", "type": "main", "index": 0 }]]
    }
  },
  "settings": {}
}
